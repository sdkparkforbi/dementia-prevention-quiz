<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì¹˜ë§¤ì˜ˆë°© ë‘ë‡Œ í™œë™</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Malgun Gothic', sans-serif;
      background: linear-gradient(135deg,#667eea,#764ba2);
      min-height:100vh;
      padding:20px;
    }
    .container { max-width:900px; margin:0 auto; }
    h1 { color:#fff; text-align:center; margin-bottom:20px; }

    .card {
      background:#fff;
      border-radius:16px;
      padding:24px;
      margin-bottom:20px;
      box-shadow:0 10px 30px rgba(0,0,0,.2);
    }

    .title { font-size:1.3em; margin-bottom:12px; color:#333; }
    .desc { color:#555; margin-bottom:12px; line-height:1.5; }

    .grid {
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:10px;
    }

    img.hwatu {
      width:80px;
      cursor:pointer;
      border-radius:8px;
    }

    .option {
      padding:14px;
      border:2px solid #e9ecef;
      border-radius:12px;
      cursor:pointer;
      background:#f8f9fa;
      margin-bottom:10px;
    }
    .option.selected {
      background:#667eea;
      color:#fff;
      border-color:#667eea;
    }

    .btn {
      width:100%;
      padding:16px;
      background:linear-gradient(135deg,#667eea,#764ba2);
      border:none;
      color:#fff;
      font-size:1.2em;
      border-radius:12px;
      cursor:pointer;
      margin-top:15px;
    }

    .hidden { display:none; }
  </style>
</head>

<body>
<div class="container">
  <h1>ğŸ§  ì˜¤ëŠ˜ì˜ ë‘ë‡Œ í™œë™</h1>

  <div class="card">
    <label>ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</label>
    <input id="userName" style="width:100%;padding:12px;font-size:1.1em">
  </div>

  <div id="app"></div>
</div>

<!-- D-ID ì•„ë°”íƒ€ -->
<script type="module"
  src="https://agent.d-id.com/v2/index.js"
  data-mode="fabio"
  data-client-key="YOUR_CLIENT_KEY"
  data-agent-id="YOUR_AGENT_ID"
  data-name="did-agent"
  data-monitor="true"
  data-position="right">
</script>

<script>
/* ===============================
   ê³µí†µ ë°ì´í„°
=============================== */
const app = document.getElementById('app');

const deck = [
  {id:1,n:'ì†Œë‚˜ë¬´',img:'/hwatu/01_pine.png'},
  {id:2,n:'ë§¤í™”',img:'/hwatu/02_plum.png'},
  {id:3,n:'ë²šê½ƒ',img:'/hwatu/03_cherry.png'},
  {id:4,n:'ë“±ë‚˜ë¬´',img:'/hwatu/04_wisteria.png'},
  {id:5,n:'ì°½í¬',img:'/hwatu/05_iris.png'},
  {id:6,n:'ëª¨ë€',img:'/hwatu/06_peony.png'},
  {id:7,n:'ì‹¸ë¦¬',img:'/hwatu/07_bushclover.png'},
  {id:8,n:'ì–µìƒˆ',img:'/hwatu/08_grass.png'},
  {id:9,n:'êµ­í™”',img:'/hwatu/09_chrysanthemum.png'},
  {id:10,n:'ë‹¨í’',img:'/hwatu/10_maple.png'},
  {id:11,n:'ì˜¤ë™',img:'/hwatu/11_paulownia.png'},
  {id:12,n:'ë¹„',img:'/hwatu/12_rain.png'}
];

let chosen = [];
let recallResult = 0;
let wordScore = 0;
let healthScore = 0;

/* ===============================
   STEP 0 ìš´ì„¸ ì¹´ë“œ ì„ íƒ
=============================== */
function startFortune() {
  chosen=[];
  const shuffled=[...deck].sort(()=>Math.random()-0.5);
  app.innerHTML=`
    <div class="card">
      <div class="title">ì˜¤ëŠ˜ì˜ í™”íˆ¬ ìš´ì„¸</div>
      <div class="desc">ë§ˆìŒì— ë“œëŠ” ì¹´ë“œ 3ì¥ì„ ê³¨ë¼ì£¼ì„¸ìš”.</div>
      <div class="grid">
        ${shuffled.map((c,i)=>`
          <img class="hwatu" src="/hwatu/back.png"
            onclick="pickCard(${i})">
        `).join('')}
      </div>
    </div>
  `;
  window._deck=shuffled;
}

function pickCard(i){
  if(chosen.length>=3)return;
  chosen.push(window._deck[i]);
  if(chosen.length===3) showMemory();
}

/* ===============================
   STEP 1 ê¸°ì–µ í™”ë©´
=============================== */
function showMemory(){
  app.innerHTML=`
    <div class="card">
      <div class="title">ì¹´ë“œë¥¼ ê¸°ì–µí•´ì£¼ì„¸ìš”</div>
      <div class="desc">ì ì‹œ í›„ ë‹¤ì‹œ ë§ì¶°ë´…ë‹ˆë‹¤.</div>
      <div class="grid">
        ${chosen.map(c=>`<img class="hwatu" src="${c.img}">`).join('')}
      </div>
    </div>
  `;
  setTimeout(recallStep,5000);
}

/* ===============================
   STEP 2 íšŒìƒ
=============================== */
function recallStep(){
  const shuffled=[...deck].sort(()=>Math.random()-0.5);
  let picked=[];
  app.innerHTML=`
    <div class="card">
      <div class="title">ë°©ê¸ˆ ë½‘ì•˜ë˜ ì¹´ë“œë¥¼ ë‹¤ì‹œ ê³¨ë¼ë³´ì„¸ìš”</div>
      <div class="grid">
        ${shuffled.map((c,i)=>`
          <img class="hwatu" src="${c.img}"
           onclick="recallPick(${i},this)">
        `).join('')}
      </div>
    </div>
  `;
  window._recallDeck=shuffled;
  window._picked=picked;
}

function recallPick(i,el){
  if(window._picked.length>=3)return;
  el.style.border='3px solid #667eea';
  window._picked.push(window._recallDeck[i]);
  if(window._picked.length===3){
    recallResult=window._picked.filter(p=>chosen.some(c=>c.id===p.id)).length;
    wordQuiz();
  }
}

/* ===============================
   STEP 3 ë‚±ë§ í€´ì¦ˆ 5ë¬¸í•­
=============================== */
const wordQuizData=[
 {q:'ë§ˆìŒì´ ì¡°ê¸‰í•˜ì§€ ì•Šê³  í¸ì•ˆí•œ ìƒíƒœ',o:['ê¸´ì¥','ì—¬ìœ ','í˜¼ë€','ë¶„ì£¼'],c:1},
 {q:'ì£¼ì˜ ê¹Šê²Œ í•˜ì§€ ì•Šê³  ëŒ€ì¶© í•˜ëŠ” ê²ƒ',o:['ì„±ì‹¤','ê¼¼ê¼¼','ì†Œí™€','ì² ì €'],c:2},
 {q:'ê²‰ìœ¼ë¡œ ë“œëŸ¬ë‚˜ì§€ ì•Šê²Œ ì¡°ìš©íˆ',o:['ê°‘ìê¸°','ì€ê·¼íˆ','í¬ê²Œ','ê¸‰íˆ'],c:1},
 {q:'ì˜ í•´ëƒˆë‹¤ê³  ëŠê»´ ë“ ë“ í•œ ìƒíƒœ',o:['ë¶ˆì•ˆ','ë¿Œë“¯','í—ˆì „','ê±±ì •'],c:1},
 {q:'ë§ˆìŒì´ ê°€ë¼ì•‰ì•„ ì¹¨ì°©í•œ ìƒíƒœ',o:['ì‚°ë§Œ','ì°¨ë¶„','ê¸‰í•¨','ì–´ìˆ˜ì„ '],c:1}
];

function wordQuiz(){
  wordScore=0;
  app.innerHTML=`
    <div class="card">
      <div class="title">ì˜¤ëŠ˜ì˜ ë‘ë‡Œ í™œë™</div>
      <div class="desc">ë‹¤ìŒ ì„¤ëª…ì— ë§ëŠ” ë‹¨ì–´ë¥¼ ê³¨ë¼ë³´ì„¸ìš”.</div>
    </div>
  `;
  wordQuizData.forEach((q,i)=>{
    app.innerHTML+=`
      <div class="card">
        <div class="desc">${q.q}</div>
        ${q.o.map((o,idx)=>`
          <div class="option"
            onclick="this.classList.toggle('selected');
            if(${idx}===${q.c})wordScore++">
            ${o}
          </div>
        `).join('')}
      </div>
    `;
  });
  app.innerHTML+=`<button class="btn" onclick="healthQuiz()">ë‹¤ìŒ</button>`;
}

/* ===============================
   STEP 4 ì¹˜ë§¤ ì˜ˆë°© ìƒì‹ í€´ì¦ˆ
=============================== */
const healthQuizData=[
 {q:'ì¹˜ë§¤ ì˜ˆë°©ì— ê°€ì¥ íš¨ê³¼ì ì¸ í™œë™ì€?',o:['TV','ìš´ë™ê³¼ ë‘ë‡Œí™œë™','í˜¼ììˆê¸°','í¸ì‹'],c:1},
 {q:'ê¸°ì–µë ¥ì— ì¢‹ì§€ ì•Šì€ ìŒì‹ì€?',o:['ìƒì„ ','ê²¬ê³¼','ì±„ì†Œ','íŒ¨ìŠ¤íŠ¸í‘¸ë“œ'],c:3},
 {q:'ì¹˜ë§¤ ì´ˆê¸° ì¦ìƒì€?',o:['ìµœê·¼ê¸°ì–µ ì €í•˜','ì™„ë²½ê¸°ì–µ','ê³¼ìˆ˜ë©´','ë¬´ì¦ìƒ'],c:0},
 {q:'ì ì ˆí•œ ìˆ˜ë©´ ì‹œê°„ì€?',o:['4','6','7-8','10'],c:2},
 {q:'ì‚¬íšŒí™œë™ì´ ì¢‹ì€ ì´ìœ ëŠ”?',o:['ëˆ','ìê·¹','ìš´ë™','ì‹ì‚¬'],c:1}
];

function healthQuiz(){
  healthScore=0;
  app.innerHTML='';
  healthQuizData.forEach((q,i)=>{
    app.innerHTML+=`
      <div class="card">
        <div class="desc">${q.q}</div>
        ${q.o.map((o,idx)=>`
          <div class="option"
           onclick="this.classList.toggle('selected');
           if(${idx}===${q.c})healthScore++">
           ${o}
          </div>
        `).join('')}
      </div>
    `;
  });
  app.innerHTML+=`<button class="btn" onclick="saveAll()">ê²°ê³¼ ì €ì¥</button>`;
}

/* ===============================
   ì €ì¥
=============================== */
async function saveAll(){
  const userName=document.getElementById('userName').value;
  await fetch('/.netlify/functions/save-answer',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      userName,
      cards:chosen,
      recall:recallResult,
      wordScore,
      healthScore,
      timestamp:new Date().toISOString()
    })
  });
  app.innerHTML=`<div class="card"><div class="title">ì˜¤ëŠ˜ë„ ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤ ğŸŒ±</div></div>`;
}

/* ì‹œì‘ */
startFortune();
</script>
</body>
</html>
